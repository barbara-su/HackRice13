<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice Activated Recorder with Auto-Stop</title>
</head>
<body>
    <button id="startRecord" disabled>Start Recording</button>
    <button id="stopRecord" disabled>Stop Recording</button>
    <audio id="audioPlayer" controls></audio>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/annyang/2.6.1/annyang.min.js"></script>
    <script>
        const startButton = document.getElementById('startRecord');
        const stopButton = document.getElementById('stopRecord');
        const audioPlayer = document.getElementById('audioPlayer');
        let mediaRecorder;
        let audioChunks = [];
        let silenceTimer;

        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    audioPlayer.src = audioUrl;
                };

                mediaRecorder.start();
                startButton.disabled = true;
                stopButton.disabled = false;

                // Start a timer to check for silence
                silenceTimer = setTimeout(stopRecording, 3000); // 3 seconds
            } catch (error) {
                console.error('Error accessing microphone:', error);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                mediaRecorder = null; // Reset the MediaRecorder instance
                startButton.disabled = false;
                stopButton.disabled = true;
                clearTimeout(silenceTimer); // Clear the silence timer
            }
        }

        // Initialize annyang
        if (annyang) {
            annyang.debug();
            
            // Define a command to activate recording
            annyang.addCommands({
                'good morning': () => {
                    startRecording();
                },
                'stop recording': () => {
                    stopRecording();
                }
            });

            // Start listening
            annyang.start();
        } else {
            console.error('Annyang not found. Voice recognition is not supported in your browser.');
        }
    </script>
</body>
</html>